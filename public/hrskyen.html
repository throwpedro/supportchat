<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="styles/hrskyen.css">
    <!--     Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>

    <!-- Latest compiled JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <title>Hr-skyen</title>
</head>

<body>
    <div class="pagewrapper">
        <div class="leftchatwrapper col-sm-3">
            <div class="leftchatheader col-sm-12">
                <p class="title">Chat Conversations</p>
                <div class="chatconversations"></div>
            </div>
        </div>
        <div class="mainchatwrapper col-sm-6">
            <div class="mainchatheader">

            </div>
            <div class="mainchatbody">
                <div id="messages">

                </div>

            </div>
            <div class="chatbottom">
                <form action="" class="chatform col-sm-12">
                    <textarea id="m" class="col-sm-12" autocomplete="off" id="m" placeholder="Type here and hit enter to send"></textarea>
                    <button style="visibility: hidden" id="sendButton">send</button>
                </form>
            </div>
        </div>
        <div class="rightchatwrapper col-sm-3">
            <div class="infowrapper col-sm-12">
                <div class="manager ">
                    <p class="managertitle">Manager:</p>
                    <p class="managername panel panel-default">managerexample</p>
                </div>
                <div class="company">
                    <p class="companytitle">Company:</p>
                    <p class="companyname panel panel-default">companyexample</p>
                </div>
            </div>
        </div>
    </div>
    <script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
    <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
    <script>
        var room = "";
        $(function () {
            var socket = io.connect('localhost', { port: 3000 });

            socket.on('connectToRoom', function (data) {
                room = data;
                console.log(data);
                appendchat();
            });

            $('#m').keypress(function (e) {
                if (e.which == 13 && !e.shiftKey) {
                    e.preventDefault();
                    $('#sendButton').trigger('click');
                }
            });

           // $('#sendButton').click(function () {
           //     $('form').submit();
           // });

            $('form').submit(function () {
                var txt = $('#m').val();
                console.log(txt);
                socket.emit('chat message', txt, room);
                $('#messages').append($('<div class="chatmessagesend">').text(txt));
                $('#messages').scrollTop(100000);
                $('#m').val('');
                return false;

            });

            socket.on('chat message', function (msg) {
                $('#messages').append($('<div class="chatmessagereceived">').text(msg));
                $('#messages').scrollTop(100000);
            });
        });

        function appendchat() {
            $('.chatconversations').append('<div class="insertonchat" style="background-color: green; height: 5em; width: 100%; border-radius: 5px;"><p class="customer"></p><p class="timestamp"></p> </div>');
        }
    </script>
</body>

</html>